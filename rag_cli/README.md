# RAG CLI - æ£€ç´¢å¢å¼ºç”Ÿæˆå‘½ä»¤è¡Œå·¥å…·

ä¸€ä¸ªåŸºäºå‘é‡ç›¸ä¼¼åº¦æœç´¢çš„RAGï¼ˆRetrieval-Augmented Generationï¼‰å‘½ä»¤è¡Œå·¥å…·ï¼Œæä¾›äº¤äº’å¼æ£€ç´¢ä½“éªŒå’Œä¸°å¯Œçš„ç»ˆç«¯æ˜¾ç¤ºã€‚

## ğŸš€ åŠŸèƒ½ç‰¹æ€§

- **ğŸ” å‘é‡ç›¸ä¼¼åº¦æ£€ç´¢** - åŸºäºpgvectorçš„è¯­ä¹‰æœç´¢
- **ğŸ’¬ äº¤äº’å¼å‘½ä»¤è¡Œç•Œé¢** - æ”¯æŒREPLé£æ ¼çš„äº¤äº’æ“ä½œ
- **ğŸ¨ ä¸°å¯Œçš„ç»ˆç«¯æ˜¾ç¤º** - ä½¿ç”¨Richåº“å®ç°ç¾è§‚çš„è¡¨æ ¼å’Œé¢æ¿
- **âš™ï¸ é…ç½®ç®¡ç†ç³»ç»Ÿ** - YAMLé…ç½®æ–‡ä»¶æ”¯æŒ
- **ğŸ“Š ç»“æœè¯¦æƒ…æŸ¥çœ‹** - æ”¯æŒæŸ¥çœ‹å®Œæ•´æ–‡æ¡£å†…å®¹å’Œå…ƒæ•°æ®
- **ğŸ”§ å‚æ•°éªŒè¯** - å®Œæ•´çš„æŸ¥è¯¢å’Œé…ç½®å‚æ•°éªŒè¯
- **ğŸ“ æœç´¢å†å²** - è®°å½•å’Œç®¡ç†æŸ¥è¯¢å†å²
- **ğŸ“¤ ç»“æœå¯¼å‡º** - æ”¯æŒJSONã€Markdownã€CSVæ ¼å¼å¯¼å‡º

## ğŸ“¦ å®‰è£…è¦æ±‚

### ç³»ç»Ÿè¦æ±‚
- Python 3.8+
- PostgreSQL 13+ with pgvectoræ‰©å±•
- å‘é‡åŒ–æœåŠ¡ï¼ˆå¦‚Ollamaã€OpenAIç­‰ï¼‰

### Pythonä¾èµ–
```bash
pip install rich typer psycopg2-binary pyyaml jieba
```

## ğŸ› ï¸ å¿«é€Ÿå¼€å§‹

### 1. é…ç½®æ•°æ®åº“
ç¡®ä¿PostgreSQLæ•°æ®åº“å·²å®‰è£…pgvectoræ‰©å±•ï¼š
```sql
CREATE EXTENSION IF NOT EXISTS vector;
```

### 2. é…ç½®åº”ç”¨
ç¼–è¾‘ `config.yaml` æ–‡ä»¶ï¼Œé…ç½®æ•°æ®åº“è¿æ¥å’Œå‘é‡åŒ–æœåŠ¡ï¼š

```yaml
# å‘é‡å­˜å‚¨é…ç½®
vector_store:
  database_url: "postgresql://postgres:postgres@localhost:5432/your_database"
  table_name: "document_chunks"
  embedding_model: "qwen3-embedding:4b"
  embedding_endpoint: "http://localhost:11434/api/embeddings"

# é‡æ’åºé…ç½®
reranker:
  enabled: true
  endpoint: "http://localhost:11435/v1/reranker"

# æ˜¾ç¤ºé…ç½®
display:
  theme: "dark"
  max_results: 10
  show_scores: true
```

### 3. è¿è¡Œåº”ç”¨

#### å•æ¬¡æ£€ç´¢æ¨¡å¼
```bash
python main.py search "ä½ çš„æŸ¥è¯¢å†…å®¹"

# å¯é€‰å‚æ•°
python main.py search "æœºå™¨å­¦ä¹ " --top-k 20 --rerank --verbose
```

#### äº¤äº’å¼æ¨¡å¼
```bash
python main.py interactive
```

## ğŸ“– ä½¿ç”¨æŒ‡å—

### äº¤äº’å¼å‘½ä»¤

åœ¨äº¤äº’å¼æ¨¡å¼ä¸­ï¼Œæ”¯æŒä»¥ä¸‹å‘½ä»¤ï¼š

| å‘½ä»¤ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `search <query>` | æ‰§è¡Œæ£€ç´¢ | `search æœºå™¨å­¦ä¹ ` |
| `rerank <query>` | æ£€ç´¢å¹¶é‡æ’åº | `rerank æ·±åº¦å­¦ä¹ ` |
| `history` | æ˜¾ç¤ºæŸ¥è¯¢å†å² | `history` |
| `detail <åºå·>` | æŸ¥çœ‹æ–‡æ¡£è¯¦æƒ… | `detail 1` |
| `config` | æ˜¾ç¤ºå½“å‰é…ç½® | `config` |
| `export <æ ¼å¼>` | å¯¼å‡ºç»“æœ | `export json` |
| `help` | æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ | `help` |
| `quit` | é€€å‡ºç¨‹åº | `quit` |

### å¿«æ·æ–¹å¼
- ç›´æ¥è¾“å…¥æŸ¥è¯¢å†…å®¹å³å¯æ‰§è¡Œæœç´¢
- æ”¯æŒ `quit`ã€`exit`ã€`q` é€€å‡º

### æŸ¥çœ‹æ–‡æ¡£è¯¦æƒ…

1. é¦–å…ˆæ‰§è¡Œæœç´¢ï¼š
```bash
> è®°å¿†ç®¡ç†
```

2. æŸ¥çœ‹æœç´¢ç»“æœåˆ—è¡¨ï¼Œç„¶åä½¿ç”¨detailå‘½ä»¤ï¼š
```bash
> detail 1    # æŸ¥çœ‹æ’åç¬¬1çš„æ–‡æ¡£
> detail 2    # æŸ¥çœ‹æ’åç¬¬2çš„æ–‡æ¡£
```

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

```
rag_cli/
â”œâ”€â”€ main.py                 # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ interactive.py          # äº¤äº’å¼å‘½ä»¤è¡Œç•Œé¢
â”œâ”€â”€ config.yaml             # é…ç½®æ–‡ä»¶
â”œâ”€â”€ core/                   # æ ¸å¿ƒåŠŸèƒ½æ¨¡å—
â”‚   â”œâ”€â”€ retriever.py       # RAGæ£€ç´¢å™¨
â”‚   â”œâ”€â”€ session.py         # äº¤äº’ä¼šè¯ç®¡ç†
â”‚   â”œâ”€â”€ display.py         # ç»“æœæ˜¾ç¤º
â”‚   â””â”€â”€ reranker.py        # é‡æ’åºå™¨
â”œâ”€â”€ models/                 # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ config.py          # é…ç½®æ¨¡å‹
â”‚   â””â”€â”€ results.py         # ç»“æœæ¨¡å‹
â”œâ”€â”€ utils/                  # å·¥å…·æ¨¡å—
â”‚   â”œâ”€â”€ validation.py      # å‚æ•°éªŒè¯
â”‚   â”œâ”€â”€ database.py        # æ•°æ®åº“å·¥å…·
â”‚   â””â”€â”€ prompts.py         # æç¤ºè¯æ¨¡æ¿
â””â”€â”€ note/                   # æ–‡æ¡£å’Œç¬”è®°
    â”œâ”€â”€ detailå‘½ä»¤ä½¿ç”¨ç¤ºä¾‹.md
    â””â”€â”€ ç§»é™¤hybrid_searchåŠŸèƒ½æ€»ç»“.md
```

## ğŸ”§ æ ¸å¿ƒç»„ä»¶

### RAGRetriever
- å‘é‡ç›¸ä¼¼åº¦æ£€ç´¢å®ç°
- æ•°æ®åº“è¿æ¥ç®¡ç†
- å¥åº·æ£€æŸ¥å’ŒçŠ¶æ€ç›‘æ§

### InteractiveSession
- äº¤äº’å¼ä¼šè¯çŠ¶æ€ç®¡ç†
- æŸ¥è¯¢å†å²è®°å½•
- ç»“æœç¼“å­˜å’Œå¯¼å‡º

### ResultDisplay
- ä¸°å¯Œçš„ç»ˆç«¯è¡¨æ ¼æ˜¾ç¤º
- æ–‡æ¡£è¯¦æƒ…é¢æ¿
- ç»Ÿè®¡ä¿¡æ¯å±•ç¤º

## âš™ï¸ é…ç½®è¯´æ˜

### å‘é‡å­˜å‚¨é…ç½®
- `database_url`: PostgreSQLè¿æ¥å­—ç¬¦ä¸²
- `table_name`: å‘é‡å­˜å‚¨è¡¨å
- `embedding_model`: å‘é‡åŒ–æ¨¡å‹åç§°
- `embedding_endpoint`: å‘é‡åŒ–æœåŠ¡ç«¯ç‚¹

### é‡æ’åºé…ç½®
- `enabled`: æ˜¯å¦å¯ç”¨é‡æ’åº
- `endpoint`: é‡æ’åºæœåŠ¡ç«¯ç‚¹
- `model`: é‡æ’åºæ¨¡å‹åç§°

### æ˜¾ç¤ºé…ç½®
- `theme`: ç»ˆç«¯ä¸»é¢˜
- `max_results`: æœ€å¤§æ˜¾ç¤ºç»“æœæ•°
- `show_scores`: æ˜¯å¦æ˜¾ç¤ºåˆ†æ•°

## ğŸ§ª æµ‹è¯•

è¿è¡Œæµ‹è¯•å¥—ä»¶ï¼š
```bash
python test_retriever.py
```

æµ‹è¯•å†…å®¹åŒ…æ‹¬ï¼š
- æ•°æ®åº“è¿æ¥æµ‹è¯•
- æ£€ç´¢åŠŸèƒ½æµ‹è¯•
- å‚æ•°éªŒè¯æµ‹è¯•

## ğŸ“ å¼€å‘è¯´æ˜

### æ·»åŠ æ–°çš„æ£€ç´¢æ¨¡å¼
1. åœ¨ `core/retriever.py` ä¸­æ·»åŠ æ–°çš„æœç´¢æ–¹æ³•
2. æ›´æ–°é…ç½®æ¨¡å‹ä»¥æ”¯æŒæ–°å‚æ•°
3. åœ¨ä¼šè¯ç®¡ç†ä¸­é›†æˆæ–°åŠŸèƒ½

### æ‰©å±•æ˜¾ç¤ºåŠŸèƒ½
1. åœ¨ `core/display.py` ä¸­æ·»åŠ æ–°çš„æ˜¾ç¤ºæ–¹æ³•
2. æ›´æ–°äº¤äº’å‘½ä»¤å¤„ç†
3. æ·»åŠ ç›¸åº”çš„æµ‹è¯•

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥æ”¹è¿›è¿™ä¸ªé¡¹ç›®ï¼

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯ã€‚

## ğŸ™ è‡´è°¢

- [Rich](https://github.com/Textualize/rich) - ä¸°å¯Œçš„ç»ˆç«¯æ˜¾ç¤ºåº“
- [Typer](https://github.com/tiangolo/typer) - ç°ä»£å‘½ä»¤è¡Œåº”ç”¨æ¡†æ¶
- [pgvector](https://github.com/pgvector/pgvector) - PostgreSQLå‘é‡æ‰©å±•