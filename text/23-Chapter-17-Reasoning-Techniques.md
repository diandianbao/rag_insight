# Chapter 17: Reasoning Techniques | 第 17 章：推理技术

本章深入探讨了智能体的先进推理方法，重点介绍多步逻辑推理和问题解决技术。这些技术超越了简单的顺序操作，使智能体的内部推理过程更加明确。这使得智能体能够分解问题、考虑中间步骤，并得出更加稳健和准确的结论。在这些先进方法中，一个核心原则是在推理过程中分配更多的计算资源。这意味着给予智能体或底层 LLM 更多的处理时间或步骤来处理查询并生成响应。智能体可以进行迭代优化、探索多种解决方案路径或利用外部工具，而不是进行快速的单次处理。这种在推理过程中延长的处理时间通常能显著提高准确性、连贯性和稳健性，尤其对于需要深入分析和思考的复杂问题。
## Practical Applications & Use Cases | 实际应用与使用案例

实际应用包括：

●**复杂问答**：促进多跳查询的解决，这类查询需要整合来自不同来源的数据并执行逻辑推理，可能涉及检查多条推理路径，并得益于更长的推理时间来综合信息。

●**数学问题解决**：将数学问题分解为更小、可解决的组成部分，展示逐步解决过程，并使用代码执行进行精确计算，其中长时间的推理能够支持更复杂的代码生成和验证。

●**代码调试与生成**：支持代理对其生成或修正代码的推理依据进行解释，顺序识别潜在问题，并根据测试结果迭代优化代码（自我修正），利用扩展的推理时间进行彻底的调试周期。

●**战略规划**：通过推理各种选项、结果和先决条件来协助制定全面计划，并根据实时反馈（ReAct）调整计划，其中深入的思考可以导致更有效和可靠的计划。

●**医疗诊断**：帮助智能体系统评估症状、检查结果和患者病史以做出诊断，在每个阶段阐述其推理过程，并可能利用外部工具进行数据检索（ReAct）。增加推理时间可以实现更全面的鉴别诊断。

●**法律分析**：支持对法律文件和判例的分析，以制定论点或提供指导，详细说明所采取的逻辑步骤，并通过自纠正（self-correction）确保逻辑一致性。增加推理时间可以进行更深入的法律研究和论点构建。

## 推理技巧

首先，我们深入探究旨在提升 AI 模型问题解决能力的核心推理技巧。

**思维链 (CoT)** 提示通过模仿逐步思考的过程（参见图 1），显著增强了大型语言模型（LLM）的复杂推理能力。CoT 提示并非直接给出答案，而是引导模型生成一系列中间推理步骤。这种清晰的拆解使 LLM 能够将复杂问题分解为更小、更易处理的子问题，从而攻克难题。这项技术显著提升了模型在需要多步推理任务上的表现，例如算术、常识推理和符号操作等。
CoT 的一个主要优势在于它能够将困难的单步问题转化为一系列简单步骤，进而提高 LLM 推理过程的透明度。这种方法不仅提高了准确性，还为模型的决策提供了有价值的洞察，有助于调试和理解。CoT 可以通过多种策略实现，包括提供展示逐步推理的少样本示例，或者直接指示模型“逐步思考”。其有效性源于它能够引导模型的内部处理流程朝着更审慎、更逻辑化的方向发展。因此，思维链已成为赋能当代 LLM 高级推理能力的关键基石。
这种增强的透明度，以及将复杂问题拆解为可管理子问题的做法，对于自主代理（Autonomous Agents）尤为重要，因为它使代理能够在复杂环境中执行更可靠、更可审计的行动。

图 1：思维链提示以及代理生成的详细、逐步响应。

让我们看一个例子。它首先包含一组指令，告诉 AI 如何思考，定义其角色以及一个明确的五步流程。这是启动结构化思考的提示。

随后，该示例展示了 CoT 过程的实际应用。标记为"Agent's Thought Process"的部分是模型执行指定步骤时的内心独白，这就是字面意义上的"思维链"。最后，"Agent's Final Answer"是经过仔细、逐步推理过程后生成的精炼且全面的输出。

你是一名信息检索代理（Information Retrieval Agent）。你的目标是通过循序渐进的思考，全面且准确地回答用户的问题。
你必须遵循以下流程：

1. **分析查询（Analyze the Query）：** 理解用户问题的核心主题和具体要求。识别关键实体、关键词以及所需信息的类型。
2. **制定搜索查询（Formulate Search Queries - 针对知识库）：** 基于你的分析，生成一份精确的搜索查询列表，用于从知识库或外部工具中检索相关信息。
3. **模拟信息检索（Simulate Information Retrieval - 自我修正/推理）：** 对于每项搜索查询，在脑海中思考预期会找到哪种信息。如果检索到内容，哪些片段会是最相关的？思考潜在的歧义或缺失的部分。
4. **综合信息（Synthesize Information）：** 基于模拟检索和你对用户原始查询的理解，将收集到的信息综合成一个连贯且完整的答案。确保回答了查询的所有方面。
5. **审查与优化（Review and Refine）：** 在最终确定答案前，批判性地评估你的回答。它是否准确？是否全面？是否易于理解？是否简洁？如果不是，确定需要改进的内容和方式。

**用户查询：**“解释经典计算机和量子计算机的主要区别，并简要描述一个量子计算的潜在应用。”
**代理的思维过程（内部思维链输出 - 由提示鼓励生成）**

**思考 1（分析查询）：**
用户希望得到两点信息：
1. 经典计算机与量子计算机的主要区别。
2. 一个潜在的量子计算应用。
关键词：经典计算机、量子计算机、区别、潜在应用。

思考 2（制定搜索查询）：
- “经典计算机 vs 量子计算机 区别”
- “量子计算机如何工作”
- “经典计算机如何工作”
- “量子计算应用”

**思考 3（模拟信息检索与识别关键概念）：**
- 从“区别”中：预期会找到比特（bits） vs 量子比特（qubits）、叠加态（superposition）、纠缠（entanglement）、概率性质、解决特定问题的计算能力等概念。
- 从“如何工作”中：经典计算机使用晶体管/二进制。量子计算机使用量子力学。
- 从“应用”中：预期会找到药物发现、材料科学、密码学、优化等。

**思考 4（综合信息）：**
经典计算机使用比特（0 或 1），并按顺序处理信息。量子计算机使用量子比特，量子比特可以同时处于 0、1 或两者兼具的状态（叠加态），并且可以相互纠缠，从而实现截然不同的计算方法。这使它们能够比经典计算机更高效地解决某些特定问题（如分解大数或模拟复杂分子）。一个潜在的应用是药物发现，量子计算机可以前所未有地准确模拟分子相互作用，从而加速新药的研发。

**思考 5（审查与优化）：**
- 区别已涵盖（比特 vs 量子比特、叠加态、纠缠、处理方式）。
- 应用已给出（药物发现）。
- 是否简洁？是。
- 是否清晰？是。
- 看起来不错。

**代理的最终答案（输出给用户）：**
经典计算机使用比特来处理信息，比特在任一时刻只能是 0 或 1，并按顺序执行操作。相比之下，量子计算机利用量子比特，量子比特可以通过叠加态同时存在于多种状态，并通过纠缠相互关联，从而实现指数级复杂的计算。这种根本性的差异使得量子机器能够解决某些问题（例如模拟分子结构或破解复杂加密），这些问题对于最强大的经典超级计算机来说都是无法攻克的。量子计算的一个重要的潜在应用在于药物发现，它精确建模分子行为的能力可以彻底改变新药的研发。

**思维树（ToT）** 是一种建立在思维链（Chain-of-Thought, CoT）基础上的推理技巧。它允许大型语言模型通过分支到不同的中间步骤，探索多条推理路径，从而形成一个树状结构（参见图 2）。这种方法通过支持回溯、自我修正和探索替代解决方案，来支持复杂的解题过程。维护一棵可能性之树，使得模型能够在最终确定答案之前评估各种推理轨迹。这种迭代过程增强了模型处理需要战略规划和决策制定的挑战性任务的能力。
图 2：思维树示例

**自我修正（Self-correction）**，也称为自我精炼（self-refinement），是代理推理过程的关键方面，尤其是在思维链提示中。它涉及代理对其生成的内容和中间思维过程进行内部评估。这种批判性审查使代理能够识别其理解或解决方案中的歧义、信息空白或不准确之处。这种审查和精炼的迭代循环允许代理调整其方法、提高响应质量，并确保在交付最终输出前的准确性和彻底性。这种内部批判增强了代理生成可靠和高质量结果的能力，正如专门的第 4 章示例所示。

这个示例展示了一个系统化的自我修正过程，这对于精炼 AI 生成的内容至关重要。它涉及一个起草、对照原始要求进行审查，以及实施具体改进的迭代循环。该示例首先概述了 AI 作为“自我修正代理”（Self-Correction Agent）的功能，并定义了一个明确的五步分析和修订工作流。随后，呈现了一份质量欠佳的社交媒体帖子“初始草稿”（Initial Draft）。“自我修正代理的思维过程”（Self-Correction Agent's Thought Process）构成了演示的核心。在这个环节，代理根据指令批判性地评估草稿，指出了诸如参与度低和行动号召模糊等弱点。然后，它提出了具体的改进建议，包括使用更具影响力的动词和表情符号。整个过程最终以“最终修订内容”（Final Revised Content）收尾，这是一个整合了自我识别调整后的、更精炼且显著改善的版本。

自我修正代理（Self-Correction Agent）工作流程示例
你是一名高度批判性且注重细节的自我修正代理（Self-Correction Agent）。

你的任务是根据原始要求审查一段先前生成的内容，并识别出需要改进的区域。你的目标是精炼内容，使其更准确、更全面、更具吸引力，并与提示（Prompt）保持一致。

你必须遵循以下自我修正流程：

1. **理解原始要求（Understand Original Requirements）： **审查生成该内容的初始提示/要求。原始意图是什么？关键的约束或目标是什么？
2. **分析现有内容（Analyze Current Content）：** 仔细阅读提供的内容。
3. **识别差异/弱点（Identify Discrepancies/Weaknesses）：** 将现有内容与原始要求进行比较。查找以下问题：
* **准确性问题：** 是否存在任何事实错误或误导性陈述？
* **完整性缺失：** 是否充分解决了原始提示的所有方面？是否遗漏了任何内容？
* **清晰度与连贯性：** 语言是否清晰、简洁、易于理解？逻辑流程是否顺畅？
* **语气与风格：** 是否与所需的语气和风格（例如，专业、引人入胜、简洁）匹配？
* **参与度：** 是否引人注目？能否吸引读者的注意力？
* **冗余/啰嗦：** 是否可以在不失原意的情况下，对某些部分进行精简或删除？
4. **提出具体改进建议（Propose Specific Improvements）：** 对于识别出的每个弱点，提出具体且可操作的更改。不要只陈述问题，还要提出解决方案。
5. **生成修订内容（Generate Revised Content）：** 基于你提出的改进建议，重写原始内容以纳入所有必要的更改。确保修订后的内容经过润饰，可供最终使用。

原始提示/要求： “撰写一篇简短、引人入胜的社交媒体帖子（最多 150 个字符），宣布新的环保产品线：‘GreenTech Gadgets’。”

**（初始草稿 - 待修正的内容）：**

“我们有新产品。它们是绿色的，科技感十足。现在就购买 GreenTech Gadgets 吧！”

**自我修正代理的思维过程（内部思维链输出 - 由提示鼓励生成）：**

**思考 1（理解原始要求）：**
简短、引人入胜的社交媒体帖子。
最多 150 个字符。
宣布“GreenTech Gadgets”——一条新的环保产品线。

**思考 2（分析现有内容）：**
“我们有新产品。它们是绿色的，科技感十足。现在就购买 GreenTech Gadgets 吧！”（64 个字符）

**思考 3（识别差异/弱点）：**
参与度： 不够吸引人。听起来很普通。
环保性： 由“绿色”（green）暗示，但没有明确强调其益处。
行动号召： “现在就购买！”尚可，但可以更有说服力。
简洁性： 虽然短，但可以使用更强有力的动词/措辞。
影响力： 缺乏新产品发布应有的兴奋感。

**思考 4（提出具体改进建议）：**
使其更具活力和兴奋感。
强调**“环保”和“创新”**。
使用更强有力的动词和更主动的语态。
添加一个清晰、引人入胜的行动号召。
确保字符数保持在 150 以内。

**思考 5（生成修订内容）：**
原稿：“我们有新产品。它们是绿色的，科技感十足。现在就购买 GreenTech Gadgets 吧！”
修订思路 1：“🌱 探索 GreenTech Gadgets！ 我们的新环保系列融合了创新与可持续性。选择绿色，选择智慧！立即购买！ #EcoFriendly #GreenTech”（148 个字符）
这次修订直接强调了环保性，使用了表情符号来增加参与度，添加了更强有力的行动号召，并包含了相关标签，同时保持在字符限制内。

**自我修正代理的最终修订内容（输出给用户）：**
🌱 探索 GreenTech Gadgets！ 我们的新环保系列融合了创新与可持续性。选择绿色，选择智慧！立即购买！ #EcoFriendly #GreenTech

从根本上说，这项技巧将质量控制措施直接整合到智能体（Agent）的内容生成过程中，从而产生更精炼、更精确、更优质的结果，能更有效地满足复杂的用户需求。

**程序辅助语言模型（Program-Aided Language Models, PALMs）** 将大语言模型（LLM）与符号推理能力相结合。这种集成允许 LLM 在问题解决过程中生成并执行代码，例如 Python。PALMs 将复杂的计算、逻辑操作和数据处理工作转移到一个确定的编程环境中。这种方法利用了传统编程的优势，来处理 LLM 在准确性或一致性方面可能表现出局限性的任务。当面临符号挑战时，模型可以生成代码、执行代码，并将结果转换为自然语言。这种混合方法将 LLM 的理解和生成能力与精确计算相结合，使模型能够解决更广泛的复杂问题，并有可能提高可靠性和准确性。这对智能体来说至关重要，因为它允许智能体通过利用精确计算以及自身的理解和生成能力，执行更准确、更可靠的行动。一个例子是 Google ADK 中使用外部工具来生成代码。

**可验证奖励的强化学习（Reinforcement Learning with Verifiable Rewards, RLVR）：** 尽管有效，但许多 LLM 使用的标准思维链（Chain-of-Thought, CoT）提示是一种相对基础的推理方法。它会生成一条单一、预定的思维路线，而无法适应问题的复杂性。为了克服这些限制，一类新型的专业**「推理模型」已被开发出来。这些模型的运作方式有所不同，它们会在提供答案之前投入可变时长的「思考」时间。这个「思考」过程会产生更广泛、更具动态性的思维链**，长度可达数千个 Token。这种扩展的推理能够支持更复杂的行为，例如自我修正和回溯，模型会针对难度更高的问题投入更多精力。赋能这些模型的关键创新是一种名为可验证奖励的强化学习（RLVR）的训练策略。通过在已知正确答案的问题上（例如数学或代码）对模型进行训练，模型通过试错学习生成有效的长篇推理。这使得模型无需直接的人类监督即可演化其问题解决能力。最终，这些推理模型不仅会产生答案，还会生成一条「推理轨迹」，展示出规划、监控和评估等高级技能。这种增强的推理和策略制定能力，是自主 AI 智能体发展的基石，使它们能够以最少的人工干预来拆解和解决复杂的任务。

**ReAct**（推理与行动，参见图 3，其中 KB 代表知识库）是一种将思维链（CoT）提示与智能体通过工具与外部环境进行交互能力相结合的范式。与生成最终答案的生成模型不同，ReAct 智能体会推理要采取哪些行动。这个推理阶段涉及一个类似于 CoT 的内部规划过程，智能体在其中确定其后续步骤、考虑可用的工具并预测结果。随后，智能体通过执行工具或函数调用（例如查询数据库、执行计算或与 API 交互）来采取行动。

图 3：推理与行动

ReAct 以交错的方式运作：智能体执行一个动作，观察结果，并将此观察结果纳入随后的推理中。这种「思考、行动、观察、思考……」的迭代循环允许智能体动态地调整其计划、修正错误，并实现需要与环境进行多次交互的目标。由于智能体对实时反馈作出响应，因此与线性 CoT 相比，这提供了一种更稳健和灵活的问题解决方法。通过将语言模型的理解和生成能力与使用工具的能力相结合，ReAct 使智能体能够执行既需要推理又需要实际执行的复杂任务。这种方法对智能体至关重要，因为它使智能体不仅能够推理，还能实际执行步骤并与动态环境进行交互。

**CoD**（辩论链，Chain of Debates）是微软提出的一种正式 AI 框架，其中多个、不同的模型协同合作并进行辩论来解决问题，超越了单个 AI 的「思维链」。该系统运作起来就像一个 AI 委员会会议，不同的模型提出初始想法、批判彼此的推理，并交换反驳意见。其主要目标是通过利用集体智慧，提高最终答案的准确性、减少偏见并改善整体质量。该方法充当 AI 版的同行评审，创建了一个透明且值得信赖的推理过程记录。最终，它代表了一种转变，即从一个单独的智能体提供答案，转向一个智能体协作团队共同寻找一个更稳健、经过验证的解决方案。

GoD（辩论图，Graph of Debates）是一种先进的具智能体特性（Agentic）框架，它将讨论重新构想为一个动态、非线性的网络，而不是一个简单的链条。在这个模型中，论点是单独的节点，通过表示「支持」或「反驳」等关系的边连接起来，反映了真实辩论的多线程特性。这种结构允许新的探究路线动态地分支出来、独立演化，甚至随时间推移而合并。结论的得出并非在序列的末尾，而是通过识别整个图中最稳健和得到充分支持的论点集群。在这种背景下，「得到充分支持」指的是坚定确立且可验证的知识。这可以包括被认为是基础事实（ground truth）的信息，即其本质上正确并被广泛接受为事实。此外，它还包括通过搜索溯源（search grounding）获得的事实证据，即信息已根据外部来源和真实世界数据进行了验证。最后，它也涉及多个模型在辩论中达成的共识，表明对所呈现信息的高度一致性和信心。这种综合方法确保了所讨论信息具有更稳健和可靠的基础。这种方法为复杂、协作的 AI 推理提供了一个更整体、更真实的模型。

**MASS（可选进阶主题）：** 对多智能体系统（Multi-Agent Systems, MAS）设计的深入分析表明，其有效性关键取决于用于编程单个智能体的提示（Prompt）质量以及决定其交互的拓扑结构。设计这些系统的复杂性非常高，因为它涉及一个庞大而错综复杂的搜索空间。为了应对这一挑战，开发了一个名为**多智能体系统搜索（MASS）**的新颖框架，用于自动化和优化 MAS 的设计。

MASS 采用一种多阶段优化策略，通过交错进行提示优化和拓扑优化，系统地导航复杂的涉及空间（参见图 4）。

**1. 块级提示优化（Block-Level Prompt Optimization）：** 该过程从对单个智能体类型或「块」的提示进行局部优化开始，以确保每个组件在集成到更大系统之前都能有效地执行其角色。这一初始步骤至关重要，因为它能确保后续的拓扑优化是建立在表现良好的智能体之上的，而不是因配置不佳的智能体而遭受复合影响。例如，在针对 HotpotQA 数据集进行优化时，「辩论者」智能体的提示被创造性地构思，指示其扮演**「某主要出版物的专家事实核查员」。其优化后的任务是仔细审查其他智能体提出的答案，将其与提供的上下文段落进行交叉引用，并识别任何不一致或未得到支持的论断。这个在块级优化过程中发现的专业角色扮演提示**，旨在使辩论者智能体在被放入更大工作流之前，就能高效地综合信息。

**2. 工作流拓扑优化（Workflow Topology Optimization）：** 在局部优化之后，MASS 通过从可定制的设计空间中选择和排列不同的智能体交互，来优化工作流拓扑。为了提高搜索效率，MASS 采用了一种影响加权方法。该方法通过测量每种拓扑结构相对于基线智能体的性能增益，计算其「增量影响」，并使用这些分数来指导搜索，使其倾向于更有前途的组合。例如，在针对 MBPP 编码任务进行优化时，拓扑搜索发现特定的混合工作流最为有效。发现的最佳拓扑结构并非一个简单的结构，而是迭代精炼过程与外部工具使用的组合。具体来说，它包含一个进行多轮反思的预测智能体，其代码由一个针对测试用例运行代码的执行智能体进行验证。这个被发现的工作流表明，对于编码任务，将迭代自我修正与外部验证相结合的结构优于更简单的 MAS 设计。

图 4：（作者供图）：多智能体系统搜索（Multi-Agent System Search, MASS）框架是一个三阶段的优化过程，它在一个包含可优化提示（指令和演示）和可配置智能体构建模块（聚合、反思、辩论、总结和工具使用）的搜索空间中进行导航。第一阶段，块级提示优化，独立优化每个智能体模块的提示。第二阶段，工作流拓扑优化，从影响加权的设计空间中采样有效的系统配置，并整合优化后的提示。最终阶段，工作流级提示优化，在确定第二阶段的最佳工作流之后，对整个多智能体系统进行第二轮提示优化。

** 3. 工作流级提示优化（Workflow-Level Prompt Optimization）：** 最终阶段涉及对整个系统提示的全局优化。在识别出性能最佳的拓扑结构后，将提示作为单一、集成的实体进行微调，以确保它们适应编排，并优化智能体之间的相互依赖关系。例如，在找到 DROP 数据集的最佳拓扑结构后，最终优化阶段会精炼**「预测智能体」（"Predictor" agent）的提示。最终优化后的提示高度详细**，首先向智能体提供数据集本身的摘要，指出其侧重于**「抽取式问答」（"extractive question answering"）和「数值信息」（"numerical information"）。然后，它包含少量示例**（few-shot examples），展示正确的问答行为，并将核心指令框定为一个高风险场景：「你是一个高度专业化的 AI，任务是为一篇紧急新闻报道提取关键的数值信息。一次现场直播正依赖你的准确性和速度」。这种结合了元知识、示例和角色扮演的多方面提示，是专门针对最终工作流进行调优的，以最大限度地提高准确性。

关键发现与原则： 实验证明，经 MASS 优化的 MAS 在一系列任务中的表现显著优于现有手动设计的系统和其他自动化设计方法。根据这项研究得出的有效 MAS 的关键设计原则有三点：

  * 在组合智能体之前，使用高质量的提示来优化单个智能体。
  * 通过组合有影响力的拓扑结构来构建 MAS，而不是探索无约束的搜索空间。
  * 通过最终的工作流级联合优化，对智能体之间的相互依赖关系进行建模和优化。</mark>

在我们讨论了关键推理技巧之后，首先让我们考察一个核心性能原则：LLM 的推理扩展定律（Scaling Inference Law for LLMs）。该定律指出，随着分配给模型的计算资源增加，模型的性能会可预测地提高。我们可以看到，在像深度研究（Deep Research）这样的复杂系统中，这个原则正在发挥作用，AI 智能体利用这些资源自主调查一个主题：将其分解为子问题，使用 Web 搜索作为工具，并综合其发现。

** 深度研究（Deep Research）。** 「深度研究」一词描述了一类具智能体特性（Agentic）的 AI 工具，它们旨在充当不知疲倦、有条不紊的研究助理。该领域的主要平台包括 Perplexity AI、Google Gemini 的研究能力以及 OpenAI ChatGPT 内部的高级功能（参见图 5）。

图 5：用于信息收集的 Google Deep Research

这些工具带来的一个根本性转变是搜索过程本身的改变。标准搜索会立即提供链接，将综合整理的工作留给你。而深度研究则采用不同的模式。在这里，你给 AI 分配一个复杂的查询任务，并授予它一个「时间预算」——通常是几分钟。作为这种耐心的回报，你将收到一份详细的报告*。

在此期间，AI 以一种具智能体特性的方式为你工作。它自主执行一系列复杂且对人来说极其耗时的步骤：

1. 初始探索： 它根据你的初始提示运行多个有针对性的搜索。

2. 推理与精炼： 它阅读和分析第一波结果，综合其发现，并批判性地识别出空白、矛盾或需要更多细节的领域。

3. 后续探究： 基于其内部推理，它进行新的、更细致的搜索，以填补这些空白并加深其理解。

4. 最终综合： 经过多轮这种迭代搜索和推理后，它将所有经过验证的信息汇编成一个单一、有凝聚力且结构化的摘要。

这种系统方法确保了全面且有充分理由支持的响应，显著提高了信息收集的效率和深度，从而促进了更具智能体特性的决策制定。
